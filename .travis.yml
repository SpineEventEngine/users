language: java

env:
  global:
    # Encrypted `CODACY_PROJECT_TOKEN` variable according to:
    # https://docs.travis-ci.com/user/environment-variables/#Encrypting-environment-variables
    - secure: "15m5uN8UnYiYlQt4B9QhWdlp457hVDljtElYRETPO7qpvhw7RK1Ge93pVcSkn0gvwmlQm1DVJ3Xs4w9NcN5ooeSGZGHmCp5eRRJhQmQFQ0vRGrRYkpSX0+JAkBMJr0cHJgjlDMNtUZs6pJYFxV0tGaXfEoOwKhbCpJ0u5sDM4c7lDtvBSpiTQe1Y6gQa2OVDKBpcjkne6gG18SlR2zBbqnkAmvm6c5GWsyuUgEBSPJ8w/1itNBixwkQdKS5Y+t8eH/vOjLR3IVeNRny8CXYLFtOCJKB4Jf15FiexRNEH1gLe7+dQgj9pulwqIvZPhMdtw32eLIDkQRRB3jtHpA78hdqagrx8y1ubdPl5VfXk8Kr+jFtu0NHlfGt1QSFNtgebr9FUf6F/yAGsnLmLZid64JkW5uQIRxVBiDJO9n54EPn+n60E9KFabQpwgqu9AW37pwdRCpIBa5AruyxwOa0ScQZxNWbSg3JS6zl5RJ4eMr8G+aoZvNEgUjHt0zlEYrtWXh0QUIRK6WJBZhRx0F44qkwTu3ZahlTTqYQVgdj4CDPpwHmTD1koPgENm5NKmicXuIft6X84/He/ZzH6yhm3hUxZaSGyLT+pzdaZ7gy7DpkOvImWA2WtO6VsizOD0yIhEX/Jlwcfdl9g2xQytP5h62xa5fIwGNpioHTTp3SxaQI="
    # Encrypted `GCS_SECRET` variable.
    - secure: "map5l2RlazZyiZ3SRa6RG9KC6E624JVN+HD2WH8sVODeUbS0XlRmQ9YZYZtQM0HiiVSjFV+Pgj9nL17s20YI4BC/Zn7B/f4lMp4+La1PfmEg3vVlW/a53tGQ/lW4AKX2SdyzbFirT22c8r/MSaksKr1zMNGfQryjh65YUbqLsMjCy2bg8RS5SPxu5Cj0Y9/QDwBnkKI1OqF5O2sps7UfFFSV3UCv3DljHYVk3W62WRQgaNUNzvoi+FEk1lxmPA4aff6ZDNIgzvpUd9qR6UpBRB8vX2t93cLTGd/Ar50H5s63GYPHhhgYJxdohoK4iZUUBmerLtTrg3w9TW8dLIKo5Lp6EM8Cj/amG+DfJoAdGP2yyvFWl4cVC/kppBgjPIlBwxZgVkWBXB7kkXh6YmKm7BPDUqDvwCPbN2Rc2WRMEJlwEApHpFH1rXuknyrxaN8YRTfCe7bhxx/VZ9qB+AqiANlW6z7gg3SlgrEJCkZC9BlhGq3tCTTpP4xvgNuAJPwsjxwesTzfyh21HFStUGFEhlbuKqpGo/i45R0frrVjuJF558ZUdJv0182s7qU0GDPiDe7qsWXVPVJSkHMRt3aksHMkbXzFrWy4W0XCZWNEcdU1fjUo2lIk+w6IwXsvX58y7+Rt3sqNcjN3xj8flNw2CppLk7f4kiBmcK+vLuC6IPQ="
      # Encrypted `CODECOV_TOKEN` variable.
    - secure: "rrcJ+CN29tD2Jgp9dbJCJ5mpzSuWZhx8mfz6cmnNjKYVRDzom+TEUBkowtcvqs9qx4F8lVyiTM5+JAGwRFROe+6gw1exHpINyrLPTVDj9uu7U1vIHMlAJiJvuijhtw0t6BLyYXc8Fu7GJYe5u4BpwgvFCuwwjZJwmjyMsjZE5bQTxtWeBrEdp2LYgsTz/ta3QJWN7o9uuPrpxqqpAcncvRtPN9uBlfC0FHliVNHC0g37WfL1pJXKzy4Ur1KEdSyZJ9Y54dW5I+RdhZG7AQLU7iBxEvL5OxOsyiXLr5Vg2xew07E4GOrQKQikQ2vT4hUvukA7m+DOrrHPSUoW/9zCsP85bBrw4O11EWj3rt9sr0pc3o9KhmVSDWbIBMyaDxXjI9KUYnxEwQ7meBcZOiIapWB2LmbZgoGy+lo56PnhjUp65r5MWygWHBigIXs16hKJUITWLnelA38rOBndFiGaNXMe9RzY4JPSAZRASdfdDTzYcvvbmZf9WxBSNbCrM07T/RRlMeA5s9O1NowvgWgAhR8NChqv9IIl4hPcH+4Xcdgkz3N2RSY2LjgC7gImitSkgEBkt6RQtfLkhXjsY0P0/J4ccekdcHg8OMDnKcv3/aa/hUVFXpdF08kZE++t65KhurNXUoZJH8U5wRXZCokJIzfYRWqB0CZxTkZGaKcrh94="

before_install:
  - chmod +x gradlew

script:
  - ./gradlew check --stacktrace

  # Decrypt and unarchive Maven and Google Cloud Storage credentials.
  - openssl aes-256-cbc -K $encrypted_4448f7b9e515_key -iv $encrypted_4448f7b9e515_iv -in credentials.tar.enc -out credentials.tar -d
  - tar xvf credentials.tar

  # The publishing script should be executed in `script` section in order to
  # fail the Travis build if execution of this script is failed.
  - chmod +x ./config/scripts/publish-artifacts.sh
  - ./config/scripts/publish-artifacts.sh

after_success:
  # See: https://github.com/codecov/example-java/blob/master/.travis.yml
  - bash <(curl -s https://codecov.io/bash)
  - chmod +x ./config/scripts/report-coverage.sh
  - ./config/scripts/report-coverage.sh

after_script:
  - chmod +x ./scripts/upload-artifacts.sh
  - ./config/scripts/upload-artifacts.sh
