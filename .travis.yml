language: java

env:
  global:
    # Encrypted `CODACY_PROJECT_TOKEN` variable according to:
    # https://docs.travis-ci.com/user/environment-variables/#Encrypting-environment-variables
    - secure: "15m5uN8UnYiYlQt4B9QhWdlp457hVDljtElYRETPO7qpvhw7RK1Ge93pVcSkn0gvwmlQm1DVJ3Xs4w9NcN5ooeSGZGHmCp5eRRJhQmQFQ0vRGrRYkpSX0+JAkBMJr0cHJgjlDMNtUZs6pJYFxV0tGaXfEoOwKhbCpJ0u5sDM4c7lDtvBSpiTQe1Y6gQa2OVDKBpcjkne6gG18SlR2zBbqnkAmvm6c5GWsyuUgEBSPJ8w/1itNBixwkQdKS5Y+t8eH/vOjLR3IVeNRny8CXYLFtOCJKB4Jf15FiexRNEH1gLe7+dQgj9pulwqIvZPhMdtw32eLIDkQRRB3jtHpA78hdqagrx8y1ubdPl5VfXk8Kr+jFtu0NHlfGt1QSFNtgebr9FUf6F/yAGsnLmLZid64JkW5uQIRxVBiDJO9n54EPn+n60E9KFabQpwgqu9AW37pwdRCpIBa5AruyxwOa0ScQZxNWbSg3JS6zl5RJ4eMr8G+aoZvNEgUjHt0zlEYrtWXh0QUIRK6WJBZhRx0F44qkwTu3ZahlTTqYQVgdj4CDPpwHmTD1koPgENm5NKmicXuIft6X84/He/ZzH6yhm3hUxZaSGyLT+pzdaZ7gy7DpkOvImWA2WtO6VsizOD0yIhEX/Jlwcfdl9g2xQytP5h62xa5fIwGNpioHTTp3SxaQI="
    # Encrypted `GCS_SECRET` variable.
    - secure: "map5l2RlazZyiZ3SRa6RG9KC6E624JVN+HD2WH8sVODeUbS0XlRmQ9YZYZtQM0HiiVSjFV+Pgj9nL17s20YI4BC/Zn7B/f4lMp4+La1PfmEg3vVlW/a53tGQ/lW4AKX2SdyzbFirT22c8r/MSaksKr1zMNGfQryjh65YUbqLsMjCy2bg8RS5SPxu5Cj0Y9/QDwBnkKI1OqF5O2sps7UfFFSV3UCv3DljHYVk3W62WRQgaNUNzvoi+FEk1lxmPA4aff6ZDNIgzvpUd9qR6UpBRB8vX2t93cLTGd/Ar50H5s63GYPHhhgYJxdohoK4iZUUBmerLtTrg3w9TW8dLIKo5Lp6EM8Cj/amG+DfJoAdGP2yyvFWl4cVC/kppBgjPIlBwxZgVkWBXB7kkXh6YmKm7BPDUqDvwCPbN2Rc2WRMEJlwEApHpFH1rXuknyrxaN8YRTfCe7bhxx/VZ9qB+AqiANlW6z7gg3SlgrEJCkZC9BlhGq3tCTTpP4xvgNuAJPwsjxwesTzfyh21HFStUGFEhlbuKqpGo/i45R0frrVjuJF558ZUdJv0182s7qU0GDPiDe7qsWXVPVJSkHMRt3aksHMkbXzFrWy4W0XCZWNEcdU1fjUo2lIk+w6IwXsvX58y7+Rt3sqNcjN3xj8flNw2CppLk7f4kiBmcK+vLuC6IPQ="
    # Encrypted `NPM_TOKEN` variable to enable JS publishing.
    - secure: AnzlOMX0l/RRFnwRKR3/Ns+uqUqAXsTgyt8h5p+SAksqibx6kjwE+zg1FoNVYtqeAJkrp7zQFTSY07HKsji0BoLfxtigb1Tsf6zO9Vv/fd145aqTQ573vjFVJ3ZRf6nGiZnNV5NSqeiM/vMU5+YcQjTAbXIWhMzjyeLOZQIPeibg3otboUkuBLhl4oJRSI9tD7sedhELUUAinG4I82CwVT339IHQWEjlg0VcrDfj2QwR5y3b7CHwludKCxufapCeS2JX6t5h5KFCSTd6P0l/xOFX5KkaX213Z7a1lXI4PSoWDOnNfgqwot4HnV64NqH/0W7fbsgWNSK2XqHMPJue1uwzgF9m73xWHNZhhP7KuTgTcLz9S7KzlrMzNWN9OuraKCe/Bnrpt1qijbK0vHVri9ozfcAV3mf1SXxICk5Cj1lEKeQek06PIWgjD9/KwnltUiZMK01BVJ8tAChO8sk97H34RBJYhOjAq913Bu4m4/85vSS0xkd5WsCP122WbE4n9V6QDkwJoO780CetRZmfTaRAkWNOdC25/gyrD6jOREmZZZwzQ0Blp52IDCnYJzQWMChWeRCTRzUz9p1fZPAqbDMNDHL9ODnC48ts93VkN+ZhsgYA5TXa2HS5SWV8S4C+IwBI9ORCec74XbVJ19lhCGuaX0KdT5IQVEfOqslRHAU=

before_install:
  - chmod +x gradlew

  # Decrypt and unarchive Maven and Google Cloud Storage credentials.
  - openssl aes-256-cbc -K $encrypted_6b4661b8f8bf_key -iv $encrypted_6b4661b8f8bf_iv -in credentials.tar.enc -out credentials.tar -d
  - tar xvf credentials.tar

script:
  - ./gradlew check --stacktrace

  # The publishing script should be executed in `script` section in order to
  # fail the Travis build if execution of this script is failed.
  - chmod +x ./config/scripts/publish-artifacts.sh
  - ./config/scripts/publish-artifacts.sh

after_success:
  # See: https://github.com/codecov/example-java/blob/master/.travis.yml
  - bash <(curl -s https://codecov.io/bash)
  - chmod +x ./config/scripts/report-coverage.sh
  - ./config/scripts/report-coverage.sh

after_script:
  - chmod +x ./scripts/upload-artifacts.sh
  - ./config/scripts/upload-artifacts.sh
