language: java

env:
  global:
    # Encrypted `CODACY_PROJECT_TOKEN` variable according to:
    # https://docs.travis-ci.com/user/environment-variables/#Encrypting-environment-variables
    - secure: "15m5uN8UnYiYlQt4B9QhWdlp457hVDljtElYRETPO7qpvhw7RK1Ge93pVcSkn0gvwmlQm1DVJ3Xs4w9NcN5ooeSGZGHmCp5eRRJhQmQFQ0vRGrRYkpSX0+JAkBMJr0cHJgjlDMNtUZs6pJYFxV0tGaXfEoOwKhbCpJ0u5sDM4c7lDtvBSpiTQe1Y6gQa2OVDKBpcjkne6gG18SlR2zBbqnkAmvm6c5GWsyuUgEBSPJ8w/1itNBixwkQdKS5Y+t8eH/vOjLR3IVeNRny8CXYLFtOCJKB4Jf15FiexRNEH1gLe7+dQgj9pulwqIvZPhMdtw32eLIDkQRRB3jtHpA78hdqagrx8y1ubdPl5VfXk8Kr+jFtu0NHlfGt1QSFNtgebr9FUf6F/yAGsnLmLZid64JkW5uQIRxVBiDJO9n54EPn+n60E9KFabQpwgqu9AW37pwdRCpIBa5AruyxwOa0ScQZxNWbSg3JS6zl5RJ4eMr8G+aoZvNEgUjHt0zlEYrtWXh0QUIRK6WJBZhRx0F44qkwTu3ZahlTTqYQVgdj4CDPpwHmTD1koPgENm5NKmicXuIft6X84/He/ZzH6yhm3hUxZaSGyLT+pzdaZ7gy7DpkOvImWA2WtO6VsizOD0yIhEX/Jlwcfdl9g2xQytP5h62xa5fIwGNpioHTTp3SxaQI="
    # Encrypted `GCS_SECRET` variable.
    - secure: MJwWe0DGfHzeP3RfiJNjD+vT1ewb+kR4FJdHxpo+RxZt/NuL0MYjcjIMR9/mRmRD3KwHB0Li16tP1ACTeaGDKemZM5ApKNsBF0XuCPMP4ql0irDW0P00pWjcpqP0ofYfjM4YpueWTtqkr6c+huMxDiKjAEpBPIZdb4av4Tb7Hp1DtGliOeL5G7E2odMDhLb8C5DA27ccyeDvlSuS8Q3PmZBO7EVZ3ISWWpo57S6FTEAQS6VCwjAiV1F5OCIPytIcbIHkt41WZKm+GLZ8LAn5pcFOCzJYbGqe1KqAFVqtLtPJw01VsyXTB/v392ZioPFsOZ5K7szXO75ltaSTv8PrwF2a4TqdZ8ps1I37TcURbu4twPrqCF3ZzBlU5VQs302B2dJlvBqgIEmUJGlTqNZTe6QgEbY5F6kD59Tnlbg4fsmgFrSpeDeEsfqtSu0K2RzxLeFF2cT6fDxg9ZKSLI6KoozFKQ3yGRk/ySj2zV7t9kaf30N7IXfu+lsPetFzEe+7oTK4DWYwt+O56he/ly+xB9bBxdVYsT73Khg/VYWt78tfqoWDtZ9xt1N4cM56iLHmImTe1JBy+35wykzpBPzCl6zRYP2qRY9XERTOyue/evgqPNvV1KZtMA6PpGhOysu1HjgNcpbfonNfL3ldj5hx2/y7HNi1uZT2jy0u2hmZGYo=

before_install:
  - chmod +x gradlew

script:
  - ./gradlew check --stacktrace

  # Decrypt and unarchive Maven and Google Cloud Storage credentials.
  - openssl aes-256-cbc -K $encrypted_4448f7b9e515_key -iv $encrypted_4448f7b9e515_iv -in credentials.tar.enc -out credentials.tar -d
  - tar xvf credentials.tar

  - ./gradlew cleanGCS --info

  # The publishing script should be executed in `script` section in order to
  # fail the Travis build if execution of this script is failed.
  - chmod +x ./scripts/publish-artifacts.sh
  - ./scripts/publish-artifacts.sh

after_success:
  # See: https://github.com/codecov/example-java/blob/master/.travis.yml
  - bash <(curl -s https://codecov.io/bash)
  - chmod +x ./scripts/report-coverage.sh
  - ./scripts/report-coverage.sh

after_script:
  - chmod +x ./scripts/upload-artifacts.sh
  - ./scripts/upload-artifacts.sh
